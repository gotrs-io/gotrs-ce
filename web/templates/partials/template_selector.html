{{define "template-selector"}}
<option value="">-- Select a template --</option>
{{if .templates}}
    {{$currentCategory := ""}}
    {{range .templates}}
        {{if ne $currentCategory .Category}}
            {{if ne $currentCategory ""}}
            </optgroup>
            {{end}}
            <optgroup label="{{.CategoryLabel}}">
            {{$currentCategory = .Category}}
        {{end}}
        <option value="{{.ID}}" 
                data-subject="{{.Subject}}"
                data-content="{{.Content}}"
                data-priority="{{.Priority}}"
                data-category="{{.Category}}">
            {{.Name}}
            {{if not .IsActive}}(Inactive){{end}}
        </option>
    {{end}}
    {{if ne $currentCategory ""}}
    </optgroup>
    {{end}}
{{else}}
    <option value="" disabled>No templates available</option>
{{end}}
{{end}}