# GOTRS Helm Chart - Default Values
# MySQL is the default database

# =============================================================================
# GLOBAL SETTINGS
# =============================================================================
global:
  # Storage class for persistent volumes (empty = cluster default)
  storageClass: ""

  # Image pull secrets for private registries
  imagePullSecrets: []

  # Common annotations applied to ALL resources
  commonAnnotations: {}

  # Common labels applied to ALL resources (merged with standard labels)
  commonLabels: {}

# =============================================================================
# BACKEND APPLICATION
# =============================================================================
backend:
  enabled: true

  image:
    repository: gotrs/backend
    tag: ""  # Defaults to appVersion
    pullPolicy: IfNotPresent

  replicaCount: 2

  service:
    type: ClusterIP
    port: 8080

  resources:
    requests:
      cpu: "250m"
      memory: "256Mi"
    limits:
      cpu: "1"
      memory: "1Gi"

  # Horizontal Pod Autoscaler
  autoscaling:
    enabled: false
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  # Liveness and readiness probes
  probes:
    liveness:
      path: /health
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 5
    readiness:
      path: /health
      initialDelaySeconds: 5
      periodSeconds: 5
      timeoutSeconds: 3

  # Extra environment variables
  extraEnv: []

  # Node selector
  nodeSelector: {}

  # Tolerations
  tolerations: []

  # Affinity rules
  affinity: {}

  # Pod annotations (e.g., prometheus.io/scrape, sidecar.istio.io/inject)
  podAnnotations: {}
  #  prometheus.io/scrape: "true"
  #  prometheus.io/port: "9090"

  # Additional pod labels
  podLabels: {}

  # Service annotations (e.g., AWS load balancer config)
  serviceAnnotations: {}
  #  service.beta.kubernetes.io/aws-load-balancer-type: "nlb"

# =============================================================================
# FRONTEND (NGINX)
# =============================================================================
frontend:
  enabled: true

  image:
    repository: nginx
    tag: "1.25-alpine"
    pullPolicy: IfNotPresent

  replicaCount: 2

  service:
    type: ClusterIP
    port: 80

  resources:
    requests:
      cpu: "50m"
      memory: "64Mi"
    limits:
      cpu: "200m"
      memory: "128Mi"

  nodeSelector: {}
  tolerations: []
  affinity: {}

  # Pod annotations
  podAnnotations: {}

  # Additional pod labels
  podLabels: {}

  # Service annotations
  serviceAnnotations: {}

# =============================================================================
# DATABASE
# =============================================================================
database:
  # Database type: mysql or postgresql
  type: mysql

  # External database (if using RDS, Cloud SQL, etc.)
  external:
    enabled: false
    host: ""
    port: ""
    database: "gotrs"
    # Reference to existing secret with keys: username, password
    existingSecret: ""

  # MySQL/MariaDB settings (when type=mysql and external.enabled=false)
  mysql:
    image:
      repository: mariadb
      tag: "11"
      pullPolicy: IfNotPresent

    # Root password - use existingSecret in production
    rootPassword: ""
    existingSecret: ""  # Secret with key: mysql-root-password

    database: gotrs
    user: gotrs
    password: ""  # Use existingSecret in production

    storage:
      size: 10Gi
      storageClass: ""  # Uses global.storageClass if empty

    resources:
      requests:
        cpu: "250m"
        memory: "512Mi"
      limits:
        cpu: "1"
        memory: "1Gi"

    # MySQL configuration
    config:
      maxConnections: 200
      innodbBufferPoolSize: "256M"

    nodeSelector: {}
    tolerations: []
    affinity: {}

    # Pod annotations
    podAnnotations: {}

    # Service annotations
    serviceAnnotations: {}

  # PostgreSQL settings (when type=postgresql and external.enabled=false)
  postgresql:
    image:
      repository: postgres
      tag: "16-alpine"
      pullPolicy: IfNotPresent

    database: gotrs
    user: gotrs
    password: ""  # Use existingSecret in production
    existingSecret: ""  # Secret with key: postgres-password

    storage:
      size: 10Gi
      storageClass: ""

    resources:
      requests:
        cpu: "250m"
        memory: "512Mi"
      limits:
        cpu: "1"
        memory: "1Gi"

    # PostgreSQL configuration
    config:
      maxConnections: 200
      sharedBuffers: "256MB"

    nodeSelector: {}
    tolerations: []
    affinity: {}

    # Pod annotations
    podAnnotations: {}

    # Service annotations
    serviceAnnotations: {}

# =============================================================================
# VALKEY (Redis-compatible cache)
# =============================================================================
valkey:
  enabled: true

  # External Valkey/Redis (if using ElastiCache, etc.)
  # Set enabled=false and configure externalValkey below

  # Values passed to valkey subchart
  # See https://github.com/valkey-io/valkey-helm for all options

  # Authentication via ACL
  auth:
    enabled: true
    # ACL configuration for default user
    # Password should be set via --set valkey.auth.aclConfig in production
    # Format: user <username> on ><password> ~* &* +@all
    aclConfig: "user default on >changeme ~* &* +@all"

  persistence:
    enabled: true
    size: 1Gi

# External Valkey/Redis configuration
externalValkey:
  enabled: false
  host: ""
  port: 6379
  password: ""
  existingSecret: ""

# =============================================================================
# INGRESS
# =============================================================================
ingress:
  enabled: false
  className: nginx

  annotations: {}
    # nginx.ingress.kubernetes.io/ssl-redirect: "true"
    # cert-manager.io/cluster-issuer: "letsencrypt-prod"

  hosts:
    - host: gotrs.local
      paths:
        - path: /
          pathType: Prefix

  tls: []
    # - secretName: gotrs-tls
    #   hosts:
    #     - gotrs.local

# =============================================================================
# SERVICE ACCOUNT
# =============================================================================
serviceAccount:
  create: true
  name: ""  # Defaults to release name
  annotations: {}

# =============================================================================
# SECRETS
# =============================================================================
secrets:
  # Create secrets from values (NOT recommended for production)
  # In production, create secrets manually or use external-secrets
  create: true

  # Application secret key for sessions/JWT
  appSecretKey: ""  # Auto-generated if empty

# =============================================================================
# GOTRS APPLICATION CONFIG
# =============================================================================
config:
  # Log level: debug, info, warn, error
  logLevel: info

  # Session configuration
  session:
    lifetime: 28800  # 8 hours in seconds

  # File storage
  storage:
    type: local  # local or s3
    path: /data/storage
    # S3 configuration (when type=s3)
    s3:
      bucket: ""
      region: ""
      endpoint: ""

  # Email configuration
  email:
    enabled: false
    smtp:
      host: ""
      port: 587
      username: ""
      password: ""
      from: "gotrs@example.com"

# =============================================================================
# EXTRA RESOURCES
# =============================================================================
# Define arbitrary Kubernetes resources with full Helm templating support.
# Resources are processed through tpl, so you can use:
#   {{ .Release.Name }}, {{ .Release.Namespace }}, {{ .Values.* }},
#   {{ .Chart.AppVersion }}, {{ include "gotrs.labels" . }}, etc.
#
# IMPORTANT: Strings containing {{ must be quoted in YAML
#
# Example:
#   extraResources:
#     - apiVersion: v1
#       kind: ConfigMap
#       metadata:
#         name: "{{ .Release.Name }}-custom-config"
#         labels:
#           {{- include "gotrs.labels" . | nindent 10 }}
#       data:
#         app-version: "{{ .Chart.AppVersion }}"
#
#     - apiVersion: policy/v1
#       kind: PodDisruptionBudget
#       metadata:
#         name: "{{ .Release.Name }}-backend-pdb"
#       spec:
#         minAvailable: 1
#         selector:
#           matchLabels:
#             app.kubernetes.io/name: gotrs
#             app.kubernetes.io/component: backend
#
extraResources: []
