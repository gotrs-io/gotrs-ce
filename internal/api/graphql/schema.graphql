scalar Time
scalar Any

# Enums
enum TicketStatus {
  NEW
  OPEN
  PENDING
  RESOLVED
  CLOSED
  MERGED
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
  CRITICAL
}

enum UserRole {
  ADMIN
  AGENT
  CUSTOMER
}

enum SortOrder {
  ASC
  DESC
}

enum TicketSortField {
  CREATED_AT
  UPDATED_AT
  PRIORITY
  STATUS
  SUBJECT
}

# Input Types
input CreateTicketInput {
  subject: String!
  description: String!
  queueId: ID!
  priority: TicketPriority
  customerId: ID
  tags: [String!]
}

input UpdateTicketInput {
  subject: String
  description: String
  status: TicketStatus
  priority: TicketPriority
  queueId: ID
  assigneeId: ID
  tags: [String!]
}

input TicketFilterInput {
  status: [TicketStatus!]
  priority: [TicketPriority!]
  queueId: [ID!]
  assigneeId: ID
  customerId: ID
  organizationId: ID
  tags: [String!]
  search: String
  createdAfter: Time
  createdBefore: Time
  updatedAfter: Time
  updatedBefore: Time
}

input PaginationInput {
  page: Int
  limit: Int
  sortBy: TicketSortField
  sortOrder: SortOrder
}

input CreateArticleInput {
  ticketId: ID!
  subject: String
  body: String!
  internal: Boolean
  attachmentIds: [ID!]
}

input CreateUserInput {
  email: String!
  name: String!
  password: String!
  role: UserRole!
  organizationId: ID
  groupIds: [ID!]
}

input UpdateUserInput {
  name: String
  email: String
  role: UserRole
  isActive: Boolean
  organizationId: ID
  groupIds: [ID!]
}

# Types
type User {
  id: ID!
  email: String!
  name: String!
  role: Role!
  groups: [Group!]!
  organization: Organization
  avatar: String
  locale: String!
  timezone: String!
  isActive: Boolean!
  lastLogin: Time
  createdAt: Time!
  updatedAt: Time!
  preferences: UserPreferences
  tickets(filter: TicketFilterInput, pagination: PaginationInput): TicketConnection!
}

type Role {
  id: ID!
  name: String!
  permissions: [String!]!
  users: [User!]!
}

type Group {
  id: ID!
  name: String!
  description: String
  members: [User!]!
  permissions: [String!]!
}

type Organization {
  id: ID!
  name: String!
  domain: String
  logo: String
  users: [User!]!
  tickets(filter: TicketFilterInput, pagination: PaginationInput): TicketConnection!
  createdAt: Time!
  updatedAt: Time!
}

type Queue {
  id: ID!
  name: String!
  description: String
  isActive: Boolean!
  priority: Int!
  agents: [User!]!
  tickets(filter: TicketFilterInput, pagination: PaginationInput): TicketConnection!
  sla: SLA
}

type Ticket {
  id: ID!
  number: String!
  subject: String!
  description: String!
  status: TicketStatus!
  priority: TicketPriority!
  queue: Queue!
  assignee: User
  customer: User!
  organization: Organization
  tags: [String!]!
  watchers: [User!]!
  articles: [Article!]!
  attachments: [Attachment!]!
  sla: SLAStatus
  escalationLevel: Int!
  mergedInto: Ticket
  splitFrom: Ticket
  relatedTickets: [Ticket!]!
  createdAt: Time!
  updatedAt: Time!
  closedAt: Time
  responseTime: Int
  resolutionTime: Int
  history: [HistoryEntry!]!
}

type Article {
  id: ID!
  ticket: Ticket!
  subject: String
  body: String!
  internal: Boolean!
  author: User!
  attachments: [Attachment!]!
  createdAt: Time!
  updatedAt: Time!
}

type Attachment {
  id: ID!
  filename: String!
  contentType: String!
  size: Int!
  url: String!
  thumbnailUrl: String
  createdAt: Time!
}

type SLA {
  id: ID!
  name: String!
  description: String
  responseTime: Int!
  resolutionTime: Int!
  escalationTime: Int!
  businessHours: BusinessHours!
}

type SLAStatus {
  sla: SLA!
  responseDeadline: Time
  resolutionDeadline: Time
  escalationDeadline: Time
  isBreached: Boolean!
  breachTime: Time
}

type BusinessHours {
  id: ID!
  name: String!
  timezone: String!
  monday: DaySchedule
  tuesday: DaySchedule
  wednesday: DaySchedule
  thursday: DaySchedule
  friday: DaySchedule
  saturday: DaySchedule
  sunday: DaySchedule
  holidays: [Holiday!]!
}

type DaySchedule {
  isWorkday: Boolean!
  openTime: String
  closeTime: String
}

type Holiday {
  date: Time!
  name: String!
}

type UserPreferences {
  theme: String!
  language: String!
  notifications: NotificationPreferences!
  dashboardLayout: Any
}

type NotificationPreferences {
  email: Boolean!
  inApp: Boolean!
  desktop: Boolean!
  ticketUpdates: Boolean!
  mentions: Boolean!
  assignments: Boolean!
}

type HistoryEntry {
  id: ID!
  ticket: Ticket!
  user: User!
  action: String!
  field: String
  oldValue: String
  newValue: String
  createdAt: Time!
}

# Connection Types for Pagination
type TicketConnection {
  edges: [TicketEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type TicketEdge {
  node: Ticket!
  cursor: String!
}

type PageInfo {
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  startCursor: String
  endCursor: String
}

# Statistics Types
type TicketStatistics {
  total: Int!
  open: Int!
  closed: Int!
  pending: Int!
  averageResponseTime: Int!
  averageResolutionTime: Int!
  slaCompliance: Float!
}

type QueueStatistics {
  queue: Queue!
  ticketCount: Int!
  averageWaitTime: Int!
  agentCount: Int!
  activeTickets: Int!
}

# Subscription Types
type TicketUpdate {
  ticket: Ticket!
  action: String!
  user: User!
  timestamp: Time!
}

# Root Types
type Query {
  # User queries
  me: User!
  user(id: ID!): User
  users(search: String, role: UserRole, isActive: Boolean): [User!]!
  
  # Ticket queries
  ticket(id: ID!): Ticket
  ticketByNumber(number: String!): Ticket
  tickets(filter: TicketFilterInput, pagination: PaginationInput): TicketConnection!
  myTickets(filter: TicketFilterInput, pagination: PaginationInput): TicketConnection!
  
  # Queue queries
  queue(id: ID!): Queue
  queues(isActive: Boolean): [Queue!]!
  queueStatistics(queueId: ID!): QueueStatistics!
  
  # Organization queries
  organization(id: ID!): Organization
  organizations(search: String): [Organization!]!
  
  # Statistics queries
  ticketStatistics(filter: TicketFilterInput): TicketStatistics!
  dashboardStatistics: DashboardStatistics!
  
  # Search
  search(query: String!, types: [String!]): SearchResult!
}

type Mutation {
  # Authentication
  login(email: String!, password: String!): AuthPayload!
  logout: Boolean!
  refreshToken(token: String!): AuthPayload!
  
  # Ticket mutations
  createTicket(input: CreateTicketInput!): Ticket!
  updateTicket(id: ID!, input: UpdateTicketInput!): Ticket!
  assignTicket(id: ID!, userId: ID!): Ticket!
  closeTicket(id: ID!, resolution: String): Ticket!
  mergeTickets(sourceId: ID!, targetId: ID!): Ticket!
  splitTicket(id: ID!, articleIds: [ID!]!): Ticket!
  
  # Article mutations
  createArticle(input: CreateArticleInput!): Article!
  updateArticle(id: ID!, body: String!): Article!
  deleteArticle(id: ID!): Boolean!
  
  # Attachment mutations
  uploadAttachment(ticketId: ID!, file: Upload!): Attachment!
  deleteAttachment(id: ID!): Boolean!
  
  # User mutations
  createUser(input: CreateUserInput!): User!
  updateUser(id: ID!, input: UpdateUserInput!): User!
  deleteUser(id: ID!): Boolean!
  updateProfile(input: UpdateUserInput!): User!
  updatePreferences(preferences: Any!): User!
  
  # Queue mutations
  createQueue(name: String!, description: String): Queue!
  updateQueue(id: ID!, name: String, description: String, isActive: Boolean): Queue!
  assignAgentToQueue(queueId: ID!, userId: ID!): Queue!
  removeAgentFromQueue(queueId: ID!, userId: ID!): Queue!
  
  # Organization mutations
  createOrganization(name: String!, domain: String): Organization!
  updateOrganization(id: ID!, name: String, domain: String): Organization!
  deleteOrganization(id: ID!): Boolean!
}

type Subscription {
  # Ticket subscriptions
  ticketUpdated(ticketId: ID): TicketUpdate!
  ticketCreated(queueId: ID): Ticket!
  ticketAssigned(userId: ID): Ticket!
  
  # Queue subscriptions
  queueUpdated(queueId: ID!): Queue!
  
  # User subscriptions
  userStatusChanged(userId: ID!): User!
  
  # System notifications
  systemNotification: SystemNotification!
}

# Additional Types
type AuthPayload {
  token: String!
  refreshToken: String!
  user: User!
  expiresAt: Time!
}

type SearchResult {
  tickets: [Ticket!]!
  users: [User!]!
  organizations: [Organization!]!
  articles: [Article!]!
  totalCount: Int!
}

type DashboardStatistics {
  ticketStats: TicketStatistics!
  queueStats: [QueueStatistics!]!
  recentTickets: [Ticket!]!
  upcomingSLAs: [Ticket!]!
  agentPerformance: [AgentPerformance!]!
}

type AgentPerformance {
  agent: User!
  ticketsResolved: Int!
  averageResponseTime: Int!
  averageResolutionTime: Int!
  satisfaction: Float!
}

type SystemNotification {
  id: ID!
  type: String!
  message: String!
  severity: String!
  timestamp: Time!
}

# File upload scalar
scalar Upload