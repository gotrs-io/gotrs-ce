{{define "search"}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search - GOTRS</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/alpinejs@3.13.5/dist/cdn.min.js" defer></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <h1 class="text-xl font-semibold text-gray-900">Search</h1>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Search Bar -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                <form id="search-form" 
                      hx-get="/api/search"
                      hx-trigger="submit"
                      hx-target="#search-results"
                      hx-indicator="#search-indicator">
                    
                    <div class="flex space-x-3">
                        <div class="flex-1">
                            <div class="relative">
                                <input type="text" 
                                       name="q"
                                       id="search-input"
                                       placeholder="Search tickets, customers, or content..."
                                       autocomplete="off"
                                       class="w-full px-4 py-3 pl-12 pr-4 text-gray-900 placeholder-gray-500 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <div class="absolute inset-y-0 left-0 flex items-center pl-4">
                                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                    </svg>
                                </div>
                                <div id="search-indicator" class="htmx-indicator absolute inset-y-0 right-0 flex items-center pr-4">
                                    <div class="animate-spin w-5 h-5 border-2 border-gray-300 border-t-indigo-600 rounded-full"></div>
                                </div>
                            </div>
                        </div>
                        <button type="submit"
                                class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            Search
                        </button>
                    </div>
                    
                    <!-- Search Filters -->
                    <div class="mt-4" x-data="{ showFilters: false }">
                        <button type="button" 
                                @click="showFilters = !showFilters"
                                class="text-sm text-indigo-600 hover:text-indigo-700 focus:outline-none">
                            <span x-text="showFilters ? 'Hide' : 'Show'"></span> Advanced Filters
                            <svg class="w-4 h-4 inline ml-1 transform transition-transform" 
                                 :class="{'rotate-180': showFilters}"
                                 fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        
                        <div x-show="showFilters" 
                             x-transition
                             class="mt-4 grid grid-cols-1 md:grid-cols-4 gap-4">
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                <select name="type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500">
                                    <option value="">All Types</option>
                                    <option value="ticket">Tickets</option>
                                    <option value="customer">Customers</option>
                                    <option value="article">Articles</option>
                                    <option value="faq">FAQs</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                <select name="status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500">
                                    <option value="">All Statuses</option>
                                    <option value="new">New</option>
                                    <option value="open">Open</option>
                                    <option value="pending">Pending</option>
                                    <option value="resolved">Resolved</option>
                                    <option value="closed">Closed</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                                <select name="priority" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500">
                                    <option value="">All Priorities</option>
                                    <option value="urgent">Urgent</option>
                                    <option value="high">High</option>
                                    <option value="normal">Normal</option>
                                    <option value="low">Low</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Date Range</label>
                                <select name="date_range" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500">
                                    <option value="">All Time</option>
                                    <option value="today">Today</option>
                                    <option value="yesterday">Yesterday</option>
                                    <option value="week">Last 7 Days</option>
                                    <option value="month">Last 30 Days</option>
                                    <option value="quarter">Last 3 Months</option>
                                    <option value="year">Last Year</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Queue</label>
                                <select name="queue" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500">
                                    <option value="">All Queues</option>
                                    <option value="general">General Support</option>
                                    <option value="technical">Technical Support</option>
                                    <option value="billing">Billing</option>
                                    <option value="sales">Sales</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Assigned To</label>
                                <select name="assigned_to" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500">
                                    <option value="">Anyone</option>
                                    <option value="me">Me</option>
                                    <option value="unassigned">Unassigned</option>
                                    <option value="team">My Team</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Customer</label>
                                <input type="text" 
                                       name="customer"
                                       placeholder="Customer name or email"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Tags</label>
                                <input type="text" 
                                       name="tags"
                                       placeholder="Comma-separated tags"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500">
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Search Suggestions -->
            <div id="search-suggestions" class="mb-6 hidden">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <p class="text-sm text-blue-800">
                        <strong>Search Tips:</strong>
                    </p>
                    <ul class="mt-2 text-sm text-blue-700 space-y-1">
                        <li>• Use quotes for exact phrases: "password reset"</li>
                        <li>• Use AND/OR for multiple terms: email AND password</li>
                        <li>• Use - to exclude terms: virus -computer</li>
                        <li>• Use wildcards: pass* (matches password, passing, etc.)</li>
                    </ul>
                </div>
            </div>

            <!-- Recent Searches -->
            <div id="recent-searches" class="mb-6">
                <h3 class="text-sm font-medium text-gray-700 mb-3">Recent Searches</h3>
                <div class="flex flex-wrap gap-2">
                    <button onclick="performSearch('password reset')"
                            class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200">
                        password reset
                    </button>
                    <button onclick="performSearch('billing issue')"
                            class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200">
                        billing issue
                    </button>
                    <button onclick="performSearch('status:open priority:high')"
                            class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200">
                        status:open priority:high
                    </button>
                    <button onclick="performSearch('created:today')"
                            class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200">
                        created:today
                    </button>
                </div>
            </div>

            <!-- Search Results -->
            <div id="search-results">
                <!-- Results will be loaded here -->
                <div class="text-center py-12">
                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    <h3 class="mt-2 text-sm font-medium text-gray-900">Start searching</h3>
                    <p class="mt-1 text-sm text-gray-500">Enter your search query above to find tickets, customers, and more.</p>
                </div>
            </div>
        </main>
    </div>

    <script>
    // Auto-complete functionality
    let searchTimeout;
    const searchInput = document.getElementById('search-input');
    
    searchInput.addEventListener('input', function(e) {
        clearTimeout(searchTimeout);
        const query = e.target.value;
        
        if (query.length >= 3) {
            searchTimeout = setTimeout(() => {
                // Trigger autocomplete
                htmx.ajax('GET', `/api/search/suggest?q=${encodeURIComponent(query)}`, {
                    target: '#search-suggestions',
                    swap: 'innerHTML'
                });
            }, 300);
        }
    });
    
    // Perform search with predefined query
    function performSearch(query) {
        document.getElementById('search-input').value = query;
        document.getElementById('search-form').dispatchEvent(new Event('submit'));
    }
    
    // Save recent searches
    function saveRecentSearch(query) {
        let recent = JSON.parse(localStorage.getItem('recentSearches') || '[]');
        recent = [query, ...recent.filter(q => q !== query)].slice(0, 5);
        localStorage.setItem('recentSearches', JSON.stringify(recent));
        updateRecentSearches();
    }
    
    // Update recent searches display
    function updateRecentSearches() {
        const recent = JSON.parse(localStorage.getItem('recentSearches') || '[]');
        if (recent.length > 0) {
            const container = document.querySelector('#recent-searches .flex');
            container.innerHTML = recent.map(query => `
                <button onclick="performSearch('${query.replace(/'/g, "\\'")}')"
                        class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200">
                    ${query}
                </button>
            `).join('');
        }
    }
    
    // Initialize
    updateRecentSearches();
    
    // Save search on form submit
    document.getElementById('search-form').addEventListener('submit', function(e) {
        const query = document.getElementById('search-input').value;
        if (query) {
            saveRecentSearch(query);
        }
    });
    
    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Ctrl+K or Cmd+K to focus search
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            document.getElementById('search-input').focus();
        }
        
        // Escape to clear search
        if (e.key === 'Escape' && document.activeElement === searchInput) {
            searchInput.value = '';
            searchInput.blur();
        }
    });
    
    // Show search tips on focus
    searchInput.addEventListener('focus', function() {
        if (!this.value) {
            document.getElementById('search-suggestions').classList.remove('hidden');
        }
    });
    
    searchInput.addEventListener('blur', function() {
        setTimeout(() => {
            document.getElementById('search-suggestions').classList.add('hidden');
        }, 200);
    });
    </script>
</body>
</html>
{{end}}