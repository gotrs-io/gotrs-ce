# Queue module configuration
module:
  name: queue
  singular: "@admin.modules.queue.singular"
  plural: "@admin.modules.queue.plural"
  table: queue
  description: "@admin.modules.queue.description"
  route_prefix: /admin/queues

fields:
  - name: id
    type: int
    db_column: id
    label: "@admin.modules.queue.fields.id.label"
    show_in_list: true
    show_in_form: false
    sortable: true
    list_position: 1

  - name: name
    type: string
    db_column: name
    label: "@admin.modules.queue.fields.name.label"
    required: true
    searchable: true
    sortable: true
    show_in_list: true
    show_in_form: true
    help: "@admin.modules.queue.fields.name.help"
    list_class: "font-bold"
    list_position: 2

  - name: group_id
    type: int
    db_column: group_id
    label: "@admin.modules.queue.fields.group_id.label"
    required: true
    show_in_list: true
    show_in_form: true
    filterable: true
    list_position: 3
    lookup_table: groups
    lookup_key: id
    lookup_display: name
    display_as: chip

  - name: system_address_id
    type: int
    db_column: system_address_id
    label: "@admin.modules.queue.fields.system_address_id.label"
    required: true
    show_in_list: false
    show_in_form: true
    lookup_table: system_address
    lookup_key: id
    lookup_display: value1
    help: "@admin.modules.queue.fields.system_address_id.help"

  - name: unlock_timeout
    type: int
    db_column: unlock_timeout
    label: "@admin.modules.queue.fields.unlock_timeout.label"
    required: false
    show_in_list: false
    show_in_form: true
    help: "@admin.modules.queue.fields.unlock_timeout.help"
    placeholder: "0"
    default: 0

  - name: follow_up_id
    type: select
    db_column: follow_up_id
    label: "@admin.modules.queue.fields.follow_up_id.label"
    required: true
    show_in_list: false
    show_in_form: true
    options:
      - value: "1"
        label: "@admin.modules.queue.fields.follow_up_id.options.possible"
      - value: "2"
        label: "@admin.modules.queue.fields.follow_up_id.options.reject"
      - value: "3"
        label: "@admin.modules.queue.fields.follow_up_id.options.new_ticket"
    default: 1
    help: "@admin.modules.queue.fields.follow_up_id.help"

  - name: follow_up_lock
    type: select
    db_column: follow_up_lock
    label: "@admin.modules.queue.fields.follow_up_lock.label"
    required: true
    show_in_list: false
    show_in_form: true
    options:
      - value: "0"
        label: "@common.no"
      - value: "1"
        label: "@common.yes"
    default: 0
    help: "@admin.modules.queue.fields.follow_up_lock.help"

  - name: salutation_id
    type: int
    db_column: salutation_id
    label: "@admin.modules.queue.fields.salutation_id.label"
    required: true
    show_in_list: false
    show_in_form: true
    lookup_table: salutation
    lookup_key: id
    lookup_display: name
    help: "@admin.modules.queue.fields.salutation_id.help"

  - name: signature_id
    type: int
    db_column: signature_id
    label: "@admin.modules.queue.fields.signature_id.label"
    required: true
    show_in_list: false
    show_in_form: true
    lookup_table: signature
    lookup_key: id
    lookup_display: name
    help: "@admin.modules.queue.fields.signature_id.help"

  - name: valid_id
    type: int
    db_column: valid_id
    label: "@common.status"
    show_in_list: true
    show_in_form: false
    default: 1
    filterable: true
    list_position: 5
    lookup_table: valid
    lookup_key: id
    lookup_display: name
    display_as: chip

  - name: comments
    type: text
    db_column: comments
    label: "@common.comments"
    required: false
    show_in_list: false
    show_in_form: true

  - name: create_time
    type: datetime
    db_column: create_time
    label: "@common.created"
    show_in_list: false
    show_in_form: false
    sortable: true

  - name: create_by
    type: int
    db_column: create_by
    label: "@common.created_by"
    show_in_list: false
    show_in_form: false

  - name: change_time
    type: datetime
    db_column: change_time
    label: "@common.modified"
    show_in_list: false
    show_in_form: false
    sortable: true

  - name: change_by
    type: int
    db_column: change_by
    label: "@common.modified_by"
    show_in_list: false
    show_in_form: false

computed_fields:
  - name: actions
    label: "@common.settings"
    show_in_list: true
    list_position: 4
    lambda: |
      var html = '<div class="flex items-center space-x-2">';
      
      // Feature indicators
      var hasFeatures = false;
      
      // Check for unlock timeout
      if (item.unlock_timeout && item.unlock_timeout > 0) {
        html += '<span class="inline-flex items-center" title="Auto-unlock after ' + item.unlock_timeout + ' minutes">';
        html += '<i class="fas fa-clock text-yellow-500"></i>';
        html += '</span>';
        hasFeatures = true;
      }
      
      // Check for follow-up lock
      if (item.follow_up_lock && item.follow_up_lock == 1) {
        html += '<span class="inline-flex items-center" title="Follow-up locked">';
        html += '<i class="fas fa-lock text-red-500"></i>';
        html += '</span>';
        hasFeatures = true;
      }
      
      // Check for email configuration
      if (item.system_address_id) {
        html += '<span class="inline-flex items-center" title="Email configured">';
        html += '<i class="fas fa-envelope text-green-500"></i>';
        html += '</span>';
        hasFeatures = true;
      }
      
      // Add divider if we have features
      if (hasFeatures) {
        html += '<span class="text-gray-300 dark:text-gray-600">|</span>';
      }
      
      // Action buttons
      html += '<a href="/admin/dynamic/queue/' + item.id + '/edit" ';
      html += 'class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300" ';
      html += 'title="Edit Queue">';
      html += '<i class="fas fa-pen"></i>';
      html += '</a>';
      
      html += '<button onclick="viewDetails(\'queue\', ' + item.id + ')" ';
      html += 'class="text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-300" ';
      html += 'title="View Details">';
      html += '<i class="fas fa-eye"></i>';
      html += '</button>';
      
      // Enable/Disable toggle based on valid_id
      if (item.valid_id == 1) {
        html += '<button onclick="toggleStatus(\'queue\', ' + item.id + ', 2)" ';
        html += 'class="text-yellow-600 hover:text-yellow-800 dark:text-yellow-400 dark:hover:text-yellow-300" ';
        html += 'title="Disable Queue">';
        html += '<i class="fas fa-toggle-on"></i>';
        html += '</button>';
      } else {
        html += '<button onclick="toggleStatus(\'queue\', ' + item.id + ', 1)" ';
        html += 'class="text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300" ';
        html += 'title="Enable Queue">';
        html += '<i class="fas fa-toggle-off"></i>';
        html += '</button>';
      }
      
      html += '<button onclick="confirmDelete(\'queue\', ' + item.id + ')" ';
      html += 'class="text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300" ';
      html += 'title="Delete Queue">';
      html += '<i class="fas fa-trash-alt"></i>';
      html += '</button>';
      
      html += '</div>';
      
      return html;

features:
  soft_delete: true
  search: true
  import_csv: true
  export_csv: true
  status_toggle: true
  color_picker: false
  filters: true

filters:
  - field: valid_id
    type: select
    label: "@common.status"
    options:
      - value: ""
        label: "@admin.filters.all_statuses"
      - value: "1"
        label: "@admin.statuses.valid"
      - value: "2"
        label: "@admin.statuses.invalid"
  - field: group_id
    type: select
    label: "@admin.modules.queue.fields.group_id.label"
    source: database
    query: "SELECT id, name FROM groups WHERE valid_id = 1 ORDER BY name"

permissions:
  - view
  - create
  - update
  - delete

validation:
  unique_fields:
    - name
  required_fields:
    - name
    - group_id