---
apiVersion: v1
kind: RouteGroup
metadata:
  name: settings
  description: "User preferences API routes (used by profile page)"
  namespace: default
  enabled: true
spec:
  prefix: ""
  middleware:
    - auth
  routes:
    # Session timeout preference (GET current value)
    - path: /api/preferences/session-timeout
      method: GET
      handler: HandleGetSessionTimeout
      description: "Get current session timeout preference"

    # Session timeout preference (POST update)
    - path: /api/preferences/session-timeout
      method: POST
      handler: HandleSetSessionTimeout
      description: "Update session timeout preference"

    # Language preference (GET current value and available languages)
    - path: /api/preferences/language
      method: GET
      handler: HandleGetLanguage
      description: "Get current language preference and available languages"

    # Language preference (POST update)
    - path: /api/preferences/language
      method: POST
      handler: HandleSetLanguage
      description: "Update language preference"

    # Theme preference (GET current value and available themes)
    - path: /api/preferences/theme
      method: GET
      handler: HandleGetTheme
      description: "Get current theme preference and available themes"

    # Theme preference (POST update - persists to database)
    - path: /api/preferences/theme
      method: POST
      handler: HandleSetTheme
      description: "Update theme preference (persists to database)"

    # API Tokens management page
    - path: /settings/tokens
      method: GET
      handler: handleApiTokensPage
      template: pages/settings/api_tokens.pongo2
      description: "Manage personal API tokens"

    # Two-Factor Authentication (2FA/TOTP) endpoints
    - path: /api/preferences/2fa/status
      method: GET
      handler: handleTOTPStatus
      description: "Get 2FA status for current user"

    - path: /api/preferences/2fa/setup
      method: POST
      handler: handleTOTPSetup
      description: "Initiate 2FA setup - returns secret and QR code"

    - path: /api/preferences/2fa/confirm
      method: POST
      handler: handleTOTPConfirm
      description: "Confirm 2FA setup with verification code"

    - path: /api/preferences/2fa/disable
      method: POST
      handler: handleTOTPDisable
      description: "Disable 2FA (requires valid code)"
