{
  "consumer": {
    "name": "gotrs-frontend"
  },
  "interactions": [
    {
      "description": "a request for API status",
      "providerState": "API is running normally",
      "request": {
        "method": "GET",
        "path": "/api/v1/status"
      },
      "response": {
        "body": {
          "data": {
            "message": "GOTRS API is running",
            "version": "0.1.0"
          },
          "success": true
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "status": 200
      }
    },
    {
      "description": "a request without auth token",
      "providerState": "no authentication",
      "request": {
        "headers": {
          "Authorization": "Bearer invalid.token"
        },
        "method": "GET",
        "path": "/api/v1/auth/me"
      },
      "response": {
        "body": {
          "error": "Unauthorized"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "status": 401
      }
    },
    {
      "description": "a login request with invalid email format",
      "providerState": "no preconditions",
      "request": {
        "body": {
          "email": "notanemail",
          "password": ""
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "method": "POST",
        "path": "/api/v1/auth/login"
      },
      "response": {
        "body": {
          "details": {
            "email": "Invalid email format",
            "password": "Password is required"
          },
          "error": "Validation failed"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "status": 400
      }
    },
    {
      "description": "a token refresh request with invalid token",
      "providerState": "no preconditions",
      "request": {
        "body": {
          "refresh_token": "invalid.refresh.token"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "method": "POST",
        "path": "/api/v1/auth/refresh"
      },
      "response": {
        "body": {
          "error": "Invalid refresh token"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "status": 401
      }
    },
    {
      "description": "a request for health status when server is down",
      "providerState": "server is experiencing issues",
      "request": {
        "method": "GET",
        "path": "/health"
      },
      "response": {
        "body": {
          "error": "Internal server error",
          "service": "gotrs-backend",
          "status": "unhealthy"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "status": 500
      }
    },
    {
      "description": "a request for health status",
      "providerState": "server is running normally",
      "request": {
        "method": "GET",
        "path": "/health"
      },
      "response": {
        "body": {
          "service": "gotrs-backend",
          "status": "healthy"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "status": 200
      }
    },
    {
      "description": "a request for a specific ticket",
      "providerState": "ticket with id 1 exists",
      "request": {
        "headers": {
          "Authorization": "Bearer valid-jwt-token"
        },
        "method": "GET",
        "path": "/api/v1/tickets/1"
      },
      "response": {
        "body": {
          "change_time": "2024-01-01T10:00:00Z",
          "create_time": "2024-01-01T10:00:00Z",
          "customer_id": 5,
          "id": 1,
          "priority": {
            "id": 3,
            "name": "Normal"
          },
          "queue": {
            "id": 1,
            "name": "General Support"
          },
          "queue_id": 1,
          "state": {
            "id": 1,
            "name": "New",
            "type_id": 1
          },
          "ticket_priority_id": 3,
          "ticket_state_id": 1,
          "title": "Test Ticket",
          "tn": "20240101-000001"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "status": 200
      }
    },
    {
      "description": "a request to add an article to a ticket",
      "providerState": "ticket with id 1 exists",
      "request": {
        "body": {
          "body": "This is a follow-up message",
          "is_visible_for_customer": 1,
          "subject": "Re: Test Ticket"
        },
        "headers": {
          "Authorization": "Bearer valid-jwt-token",
          "Content-Type": "application/json"
        },
        "method": "POST",
        "path": "/api/v1/tickets/1/articles"
      },
      "response": {
        "body": {
          "article_type_id": 7,
          "body": "This is a follow-up message",
          "create_time": "2024-01-01T13:00:00Z",
          "id": 1,
          "is_visible_for_customer": 1,
          "sender_type_id": 1,
          "subject": "Re: Test Ticket",
          "ticket_id": 1
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "matchingRules": {
          "$.body.create_time": {
            "match": "type"
          },
          "$.body.id": {
            "match": "type"
          }
        },
        "status": 201
      }
    },
    {
      "description": "a request to update a ticket",
      "providerState": "ticket with id 1 exists",
      "request": {
        "body": {
          "state_id": 2,
          "title": "Updated Title"
        },
        "headers": {
          "Authorization": "Bearer valid-jwt-token",
          "Content-Type": "application/json"
        },
        "method": "PUT",
        "path": "/api/v1/tickets/1"
      },
      "response": {
        "body": {
          "change_time": "2024-01-01T12:00:00Z",
          "id": 1,
          "queue_id": 1,
          "ticket_priority_id": 3,
          "ticket_state_id": 2,
          "title": "Updated Title",
          "tn": "20240101-000001"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "matchingRules": {
          "$.body.change_time": {
            "match": "type"
          }
        },
        "status": 200
      }
    },
    {
      "description": "a request to delete a ticket",
      "providerState": "ticket with id 1 exists and user has permission",
      "request": {
        "headers": {
          "Authorization": "Bearer valid-jwt-token"
        },
        "method": "DELETE",
        "path": "/api/v1/tickets/1"
      },
      "response": {
        "status": 204
      }
    },
    {
      "description": "a request for a non-existent ticket",
      "providerState": "ticket with id 999 does not exist",
      "request": {
        "headers": {
          "Authorization": "Bearer valid-jwt-token"
        },
        "method": "GET",
        "path": "/api/v1/tickets/999"
      },
      "response": {
        "body": {
          "error": "Ticket not found"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "status": 404
      }
    },
    {
      "description": "a request for ticket list",
      "providerState": "tickets exist",
      "request": {
        "headers": {
          "Authorization": "Bearer valid-jwt-token"
        },
        "method": "GET",
        "path": "/api/v1/tickets"
      },
      "response": {
        "body": {
          "page": 1,
          "per_page": 25,
          "tickets": [
            {
              "change_time": "2024-01-01T10:00:00Z",
              "create_time": "2024-01-01T10:00:00Z",
              "id": 1,
              "queue_id": 1,
              "ticket_priority_id": 3,
              "ticket_state_id": 1,
              "title": "Example Ticket",
              "tn": "20240101-000001"
            }
          ],
          "total": 50,
          "total_pages": 2
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "matchingRules": {
          "$.body.page": {
            "match": "type"
          },
          "$.body.per_page": {
            "match": "type"
          },
          "$.body.tickets": {
            "match": "type",
            "min": 1
          },
          "$.body.tickets[*].change_time": {
            "match": "type"
          },
          "$.body.tickets[*].create_time": {
            "match": "type"
          },
          "$.body.tickets[*].id": {
            "match": "type"
          },
          "$.body.tickets[*].queue_id": {
            "match": "type"
          },
          "$.body.tickets[*].ticket_priority_id": {
            "match": "type"
          },
          "$.body.tickets[*].ticket_state_id": {
            "match": "type"
          },
          "$.body.tickets[*].title": {
            "match": "type"
          },
          "$.body.tickets[*].tn": {
            "match": "regex",
            "regex": "\\d{8}-\\d{6}"
          },
          "$.body.total": {
            "match": "type"
          },
          "$.body.total_pages": {
            "match": "type"
          }
        },
        "status": 200
      }
    },
    {
      "description": "a request for tickets filtered by queue",
      "providerState": "tickets exist in queue 2",
      "request": {
        "headers": {
          "Authorization": "Bearer valid-jwt-token"
        },
        "method": "GET",
        "path": "/api/v1/tickets",
        "query": "queue_id=2"
      },
      "response": {
        "body": {
          "page": 1,
          "per_page": 25,
          "tickets": [
            {
              "id": 1,
              "queue_id": 2,
              "ticket_priority_id": 3,
              "ticket_state_id": 1,
              "title": "Filtered Ticket",
              "tn": "20240101-000001"
            }
          ],
          "total": 10,
          "total_pages": 1
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "matchingRules": {
          "$.body.tickets": {
            "match": "type",
            "min": 1
          },
          "$.body.tickets[*].id": {
            "match": "type"
          },
          "$.body.tickets[*].ticket_priority_id": {
            "match": "type"
          },
          "$.body.tickets[*].ticket_state_id": {
            "match": "type"
          },
          "$.body.tickets[*].title": {
            "match": "type"
          },
          "$.body.tickets[*].tn": {
            "match": "type"
          },
          "$.body.total": {
            "match": "type"
          }
        },
        "status": 200
      }
    },
    {
      "description": "a login request for a locked account",
      "providerState": "user account is locked due to too many failed attempts",
      "request": {
        "body": {
          "email": "locked@example.com",
          "password": "anypassword"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "method": "POST",
        "path": "/api/v1/auth/login"
      },
      "response": {
        "body": {
          "error": "Account is locked. Please contact support."
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "status": 423
      }
    },
    {
      "description": "a request to delete a ticket without permission",
      "providerState": "user does not have permission to delete ticket",
      "request": {
        "headers": {
          "Authorization": "Bearer valid-jwt-token"
        },
        "method": "DELETE",
        "path": "/api/v1/tickets/1"
      },
      "response": {
        "body": {
          "error": "Forbidden: You do not have permission to delete this ticket"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "status": 403
      }
    },
    {
      "description": "a password change request with weak new password",
      "providerState": "user is authenticated",
      "request": {
        "body": {
          "new_password": "123",
          "old_password": "currentPassword123"
        },
        "headers": {
          "Authorization": "Bearer valid.jwt.token",
          "Content-Type": "application/json"
        },
        "method": "POST",
        "path": "/api/v1/auth/change-password"
      },
      "response": {
        "body": {
          "details": {
            "min_length": 8,
            "requirements": [
              "Must contain uppercase",
              "Must contain lowercase",
              "Must contain number"
            ]
          },
          "error": "Password does not meet strength requirements"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "status": 400
      }
    },
    {
      "description": "a password change request with wrong old password",
      "providerState": "user is authenticated",
      "request": {
        "body": {
          "new_password": "newSecurePassword456",
          "old_password": "wrongPassword"
        },
        "headers": {
          "Authorization": "Bearer valid.jwt.token",
          "Content-Type": "application/json"
        },
        "method": "POST",
        "path": "/api/v1/auth/change-password"
      },
      "response": {
        "body": {
          "error": "Invalid old password"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "status": 400
      }
    },
    {
      "description": "a request for current user info",
      "providerState": "user is authenticated",
      "request": {
        "headers": {
          "Authorization": "Bearer valid.jwt.token"
        },
        "method": "GET",
        "path": "/api/v1/auth/me"
      },
      "response": {
        "body": {
          "email": "admin@example.com",
          "first_name": "John",
          "id": 1,
          "last_name": "Doe",
          "role": "Admin",
          "tenant_id": 1
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "matchingRules": {
          "$.body.email": {
            "match": "type"
          },
          "$.body.first_name": {
            "match": "type"
          },
          "$.body.id": {
            "match": "type"
          },
          "$.body.last_name": {
            "match": "type"
          },
          "$.body.role": {
            "match": "type"
          },
          "$.body.tenant_id": {
            "match": "type"
          }
        },
        "status": 200
      }
    },
    {
      "description": "a request to create a ticket",
      "providerState": "user is authenticated",
      "request": {
        "body": {
          "body": "I need help with my account",
          "priority_id": 3,
          "queue_id": 1,
          "subject": "Account Issue",
          "title": "New Support Request"
        },
        "headers": {
          "Authorization": "Bearer valid-jwt-token",
          "Content-Type": "application/json"
        },
        "method": "POST",
        "path": "/api/v1/tickets"
      },
      "response": {
        "body": {
          "change_time": "2024-01-01T11:00:00Z",
          "create_time": "2024-01-01T11:00:00Z",
          "id": 2,
          "queue_id": 1,
          "ticket_priority_id": 3,
          "ticket_state_id": 1,
          "title": "New Support Request",
          "tn": "20240101-000002"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "matchingRules": {
          "$.body.change_time": {
            "match": "type"
          },
          "$.body.create_time": {
            "match": "type"
          },
          "$.body.id": {
            "match": "type"
          },
          "$.body.tn": {
            "match": "regex",
            "regex": "\\d{8}-\\d{6}"
          }
        },
        "status": 201
      }
    },
    {
      "description": "an invalid ticket creation request",
      "providerState": "user is authenticated",
      "request": {
        "body": {
          "queue_id": 1
        },
        "headers": {
          "Authorization": "Bearer valid-jwt-token",
          "Content-Type": "application/json"
        },
        "method": "POST",
        "path": "/api/v1/tickets"
      },
      "response": {
        "body": {
          "details": {
            "body": "Body is required",
            "priority_id": "Priority is required",
            "title": "Title is required"
          },
          "error": "Validation failed"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "status": 400
      }
    },
    {
      "description": "a password change request",
      "providerState": "user is authenticated with password currentPassword123",
      "request": {
        "body": {
          "new_password": "newSecurePassword456",
          "old_password": "currentPassword123"
        },
        "headers": {
          "Authorization": "Bearer valid.jwt.token",
          "Content-Type": "application/json"
        },
        "method": "POST",
        "path": "/api/v1/auth/change-password"
      },
      "response": {
        "body": {
          "message": "Password changed successfully"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "status": 200
      }
    },
    {
      "description": "a logout request",
      "providerState": "user is logged in",
      "request": {
        "headers": {
          "Authorization": "Bearer valid.jwt.token"
        },
        "method": "POST",
        "path": "/api/v1/auth/logout"
      },
      "response": {
        "body": {
          "message": "Logged out successfully"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "status": 200
      }
    },
    {
      "description": "a request without valid auth token",
      "providerState": "user is not authenticated",
      "request": {
        "headers": {
          "Authorization": "Bearer invalid-token"
        },
        "method": "GET",
        "path": "/api/v1/tickets"
      },
      "response": {
        "body": {
          "error": "Unauthorized"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "status": 401
      }
    },
    {
      "description": "a login request with invalid password",
      "providerState": "user with email admin@example.com exists",
      "request": {
        "body": {
          "email": "admin@example.com",
          "password": "wrongpassword"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "method": "POST",
        "path": "/api/v1/auth/login"
      },
      "response": {
        "body": {
          "error": "Invalid email or password"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "status": 401
      }
    },
    {
      "description": "a login request with valid credentials",
      "providerState": "user with email admin@example.com exists with correct password",
      "request": {
        "body": {
          "email": "admin@example.com",
          "password": "correctpassword"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "method": "POST",
        "path": "/api/v1/auth/login"
      },
      "response": {
        "body": {
          "refresh_token": "test-refresh-token-pact-testing-only",
          "token": "test-access-token-pact-testing-only",
          "user": {
            "email": "admin@example.com",
            "first_name": "John",
            "id": 1,
            "last_name": "Doe",
            "role": "Admin"
          }
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "matchingRules": {
          "$.body.refresh_token": {
            "match": "regex",
            "regex": "^[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+$"
          },
          "$.body.token": {
            "match": "regex",
            "regex": "^[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+$"
          },
          "$.body.user.first_name": {
            "match": "type"
          },
          "$.body.user.id": {
            "match": "type"
          },
          "$.body.user.last_name": {
            "match": "type"
          }
        },
        "status": 200
      }
    },
    {
      "description": "a token refresh request",
      "providerState": "valid refresh token exists",
      "request": {
        "body": {
          "refresh_token": "valid.refresh.token"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "method": "POST",
        "path": "/api/v1/auth/refresh"
      },
      "response": {
        "body": {
          "refresh_token": "test-refresh-token-pact-testing-only",
          "token": "test-access-token-pact-testing-only"
        },
        "headers": {
          "Content-Type": "application/json"
        },
        "matchingRules": {
          "$.body.refresh_token": {
            "match": "regex",
            "regex": "^[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+$"
          },
          "$.body.token": {
            "match": "regex",
            "regex": "^[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+$"
          }
        },
        "status": 200
      }
    }
  ],
  "metadata": {
    "pact-js": {
      "version": "12.5.2"
    },
    "pactRust": {
      "ffi": "0.4.20",
      "models": "1.2.0"
    },
    "pactSpecification": {
      "version": "2.0.0"
    }
  },
  "provider": {
    "name": "gotrs-backend"
  }
}